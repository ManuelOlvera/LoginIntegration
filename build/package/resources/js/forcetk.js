var forcetk=window.forcetk;if(forcetk===undefined){forcetk={}}if(forcetk.Client===undefined){if(window.$j===undefined){$j=$}forcetk.Client=function(a,b,c){this.clientId=a;this.loginUrl=b||"https://login.salesforce.com/";if(typeof c==="undefined"||c===null){if(location.protocol==="file:"){this.proxyUrl=null}else{this.proxyUrl=location.protocol+"//"+location.hostname+"/services/proxy"}this.authzHeader="Authorization"}else{this.proxyUrl=c;this.authzHeader="X-Authorization"}this.refreshToken=null;this.sessionId=null;this.apiVersion=null;this.instanceUrl=null;this.asyncAjax=true};forcetk.Client.prototype.setRefreshToken=function(a){this.refreshToken=a};forcetk.Client.prototype.refreshAccessToken=function(d,b){var c=this;var a=this.loginUrl+"/services/oauth2/token";$j.ajax({type:"POST",url:(this.proxyUrl!==null)?this.proxyUrl:a,cache:false,processData:false,data:"grant_type=refresh_token&client_id="+this.clientId+"&refresh_token="+this.refreshToken,success:d,error:b,dataType:"json",beforeSend:function(e){if(c.proxyUrl!==null){e.setRequestHeader("SalesforceProxy-Endpoint",a)}}})};forcetk.Client.prototype.setSessionToken=function(e,c,b){this.sessionId=e;this.apiVersion=(typeof c==="undefined"||c===null)?"v24.0":c;if(typeof b==="undefined"||b==null){var d=location.hostname.split(".");var a=(d.length==3)?d[0]:d[1];this.instanceUrl="https://"+a+".salesforce.com"}else{this.instanceUrl=b}};forcetk.Client.prototype.ajax=function(f,h,c,g,e,a){var d=this;var b=this.instanceUrl+"/services/data"+f;$j.ajax({type:g||"GET",async:this.asyncAjax,url:(this.proxyUrl!==null)?this.proxyUrl:b,contentType:"application/json",cache:false,processData:false,data:e,success:h,error:(!this.refreshToken||a)?c:function(i,k,j){if(i.status===401){d.refreshAccessToken(function(l){d.setSessionToken(l.access_token,null,l.instance_url);d.ajax(f,h,c,g,e,true)},c)}else{c(i,k,j)}},dataType:"json",beforeSend:function(i){if(d.proxyUrl!==null){i.setRequestHeader("SalesforceProxy-Endpoint",b)}i.setRequestHeader(d.authzHeader,"OAuth "+d.sessionId);i.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+d.apiVersion)}})};forcetk.Client.prototype.getChatterFile=function(f,g,h,c,a){var e=this;var b=this.instanceUrl+f;var d=new XMLHttpRequest();d.open("GET",(this.proxyUrl!==null)?this.proxyUrl:b,true);d.responseType="arraybuffer";d.setRequestHeader(e.authzHeader,"OAuth "+e.sessionId);d.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+e.apiVersion);if(this.proxyUrl!==null){d.setRequestHeader("SalesforceProxy-Endpoint",b)}d.onreadystatechange=function(){if(d.readyState==4){if(d.status==200){try{h(d.response)}catch(i){alert("Error reading the response: "+i.toString())}}else{if(d.status==401&&!a){e.refreshAccessToken(function(j){e.setSessionToken(j.access_token,null,j.instance_url);e.getChatterFile(f,g,h,c,true)},c)}else{c(d,d.statusText,d.response)}}}};d.send()};forcetk.Client.prototype.apexrest=function(i,h,e,a,g,f,b){var d=this;var c=this.instanceUrl+"/services/apexrest"+i;$j.ajax({type:a||"GET",async:this.asyncAjax,url:(this.proxyUrl!==null)?this.proxyUrl:c,contentType:"application/json",cache:false,processData:false,data:g,success:h,error:(!this.refreshToken||b)?e:function(j,l,k){if(j.status===401){d.refreshAccessToken(function(m){d.setSessionToken(m.access_token,null,m.instance_url);d.apexrest(i,h,e,a,g,f,true)},e)}else{e(j,l,k)}},dataType:"json",beforeSend:function(j){if(d.proxyUrl!==null){j.setRequestHeader("SalesforceProxy-Endpoint",c)}if(f===null){f={}}for(paramName in f){j.setRequestHeader(paramName,f[paramName])}j.setRequestHeader(d.authzHeader,"OAuth "+d.sessionId);j.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+d.apiVersion)}})};forcetk.Client.prototype.versions=function(b,a){this.ajax("/",b,a)};forcetk.Client.prototype.resources=function(b,a){this.ajax("/"+this.apiVersion+"/",b,a)};forcetk.Client.prototype.describeGlobal=function(b,a){this.ajax("/"+this.apiVersion+"/sobjects/",b,a)};forcetk.Client.prototype.metadata=function(a,c,b){this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/",c,b)};forcetk.Client.prototype.describe=function(a,c,b){this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/describe/",c,b)};forcetk.Client.prototype.create=function(b,a,d,c){this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/",d,c,"POST",JSON.stringify(a))};forcetk.Client.prototype.retrieve=function(b,f,d,e,c){if(!arguments[4]){c=e;e=d;d=null}var a=d?"?fields="+d:"";this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/"+f+a,e,c)};forcetk.Client.prototype.upsert=function(b,e,d,a,f,c){this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/"+e+"/"+d+"?_HttpMethod=PATCH",f,c,"POST",JSON.stringify(a))};forcetk.Client.prototype.update=function(b,e,a,d,c){this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/"+e+"?_HttpMethod=PATCH",d,c,"POST",JSON.stringify(a))};forcetk.Client.prototype.del=function(a,d,c,b){this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+d,c,b,"DELETE")};forcetk.Client.prototype.query=function(c,b,a){this.ajax("/"+this.apiVersion+"/query?q="+escape(c),b,a)};forcetk.Client.prototype.queryMore=function(c,e,b){var d="services/data";var a=c.indexOf(d);if(a>-1){c=c.substr(a+d.length)}else{}this.ajax(c,e,b)};forcetk.Client.prototype.search=function(b,c,a){this.ajax("/"+this.apiVersion+"/search?s="+escape(b),c,a)}};